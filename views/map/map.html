<div id="ttt" class="mapp" onselectstart="return false;" style="height: 844px; witdh:800px; -moz-user-select:none;">

</div>

<!--城市列表-->

<div class="map_popup" id="cityList" style="display:none;">
    <div class="popup_main">
        <div class="title">城市列表</div>
        <div class="cityList" id="citylist_container"></div>
        <button id="popup_close"></button>
    </div>
</div>

<div class="mapL">
    <div class="mapLT">
        <div class="mapLTT clearfix">
            <div class="mapSea w_360" id="suggestId"><input placeholder="楼盘名/地名/开发商" type="text" id="xfmap_E01_46"
                                                            style="color: rgb(153, 153, 153);"
                                                            value="大华闪购会 不止特价房"><a id="xfmap_E01_06"></a>
                <ul class="seaTip dis" id="search_ad" style="display: none;">
                    <li class="adv"><a class="clearfix ad"
                                       href="http://newhouse.hn.fang.com/zt/201605/top10shangouhn.html"
                                       target="_blank" id="xfmap_D02_25" style="color:#cf0000">TOP10闪购 爆款一网打尽</a>
                    </li>
                    <li class="adv"><a class="clearfix ad" href="http://newhouse.hn.fang.com/zt/201605/jgdff.html"
                                       target="_blank" id="xfmap_D02_26" style="color:#cf0000">大华闪购会 不止特价房</a></li>
                </ul>
            </div>


            <select class="haveSelM1" name="city_id" id="city_id" onchange="submiBtn()">
                <option value="111" selected="selected">区域</option>
                <option value="460100">海口市</option>
                <option value="460200">三亚市</option>
                <option value="460500">澄迈县</option>
                <option value="460400">琼海市</option>
                <option value="460600">文昌市</option>
                <option value="460700">万宁市</option>
                <option value="460300">东方市</option>
                <option value="460800">定安县</option>
                <option value="469000">屯昌县</option>
                <option value="460100">临高县</option>
                <option value="460120">白沙县</option>
                <option value="460130">昌江县</option>
                <option value="460140">乐东县</option>
                <option value="460700">兴隆镇</option>
            </select>

            <select class="haveSelM2" name="active_price" id="active_price" onchange="submiBtn()">
                <option value="222" selected="selected">价格</option>
                <option value="4000">4000以下</option>
                <option value="6000">4000-6000</option>
                <option value="8000">6000-8000</option>
                <option value="10000">8000-100000</option>
                <option value="11000">100000以上</option>
            </select>
            <select class="haveSelM3" name="acreage" id="acreage" onchange="submiBtn()">
                <option value="333" selected="selected">面积</option>
                <option value="50"> 50㎡以下</option>
                <option value="70">50-70㎡</option>
                <option value="90">70-90㎡</option>
                <option value="110">90-110㎡</option>
                <option value="150">110-150㎡</option>
            </select>
            <select class="haveSelM4" name="shi" id="shi" onchange="submiBtn()">
                <option value="444" selected="selected">户型</option>
                <option value="1">一居</option>
                <option value="2">二居</option>
                <option value="3">三居</option>
                <option value="4">四居</option>
                <option value="5">五居居</option>
                <option value="6">五居以上</option>
            </select>


        </div>


        <script type="text/javascript"
                src="http://api.map.baidu.com/api?v=2.0&ak=lR8YgG9kxGWrpjNgVQgxgqi0OVyNpAIh"></script>
        <!-- 加载百度地图样式信息窗口 -->
        <script type="text/javascript"
                src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
        <link rel="stylesheet"
              href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css"/>
        <!-- 加载城市列表 -->
        <script type="text/javascript" src="http://api.map.baidu.com/library/CityList/1.2/src/CityList_min.js"></script>
        <script type="text/javascript"
                src="http://api.map.baidu.com/library/RichMarker/1.2/src/RichMarker_min.js"></script>
        <script type="text/javascript">
            var map = new BMap.Map("ttt");          // 创建地图实例
            var point = new BMap.Point(110.301567, 20.013559);  // 创建点坐标
            map.centerAndZoom(point, 12);                 // 初始化地图，设置中心点坐标和地图级别
            map.enableScrollWheelZoom();
            map.addControl(new BMap.NavigationControl());  //添加默认缩放平移控件
            function submiBtn() {

                value = $("#loupanText").val();
                if (value == "" || value == "请输入关键字（楼盘名）") {
                    alert("请输入楼盘名称");
                } else {
                    // 根据条件 设置中心坐标
                    var city_id = $(".haveSelM1").val();


                    if (city_id == '460100') {
                        x = "110.299848";
                        y = "20.021123";
                    } else if (city_id == '460200') {
                        var x = "109.516346";
                        var y = "18.257942";
                    } else if (city_id == '460500') {
                        var x = "110.012617";
                        var y = "19.741514";
                    } else if (city_id == '460400') {
                        var x = "110.485375";
                        var y = "19.262427";
                    } else if (city_id == '460600') {
                        var x = "110.808991";
                        var y = "19.741514";
                    } else if (city_id == '460700') {
                        var x = "110.397725";
                        var y = "18.801295";
                    } else if (city_id == '460300') {
                        var x = "108.658514";
                        var y = "19.103064";
                    } else if (city_id == '460800') {
                        var x = "110.36612";
                        var y = "19.686898";
                    } else if (city_id == '469000') {
                        var x = "110.111197";
                        var y = "19.357635";
                    } else if (city_id == '460100') {
                        var x = "109.697787";
                        var y = "19.918299";
                    } else if (city_id == '460120') {
                        var x = "109.457711";
                        var y = "19.231907";
                    } else if (city_id == '460130') {
                        var x = "109.06263";
                        var y = "19.304712";
                    } else if (city_id == '460140') {
                        var x = "109.179257";
                        var y = "18.756883";
                    } else if (city_id == '460700') {
                        var x = "110.233622";
                        var y = "18.751916";
                    } else {
                        x = "110.299848";
                        y = "20.021123";
                    }
                    map.centerAndZoom(new BMap.Point(x, y), 12);
                    //map.clearOverlays();

                    // $("#loupanNum").html(icon);
                    var sortName = $("#sortName").val();
                    var sortType = $("#sortType").val();

                    var bs = map.getBounds();   //获取可视区域
                    var bssw = bs.getSouthWest();   //可视区域左下角
                    var bsne = bs.getNorthEast();   //可视区域右上角
                    var city_id = $(".haveSelM1").val();
                    var active_price = $(".haveSelM2").val();
                    var acreage = $(".haveSelM3").val();
                    var shi = $(".haveSelM4").val();

                    params = {
                        proId: proId,
                        city_id: city_id,
                        active_price: active_price,
                        acreage: acreage,
                        shi: shi
                    }
                    ajaxGet("get", URLMAP.findListByselect, params, function (data) {


                        if (data.statusCode == "0000") {

                            var obj = data;
                            //alert("Data Loaded: " + obj.status);
                            //先清空左侧buildingList
                            window.listDate = obj.data;
                            $("#buildingList").empty();
                            $.each(listDate, function (i, n) {
                                biaozhu(n);

                            });


//                            var sublist=data.data;
//                          //  alert(sublist.length);
//
//                            for (var i = 0; i < sublist.length ; i++) {
//                                var position_info = sublist[i];
//                                var lng = position_info["map_x"];
//                                var lat = position_info["map_y"];
//                                var title = position_info["buildings_name"];
//                                var point = new BMap.Point(lng, lat);
//                                var id = position_info["id"];
//                                var htm =  '<p class="icon3" id="m'+id+'"><span>'+title+'</span></div></span></p>';
//                                var myRichMarkerObject = new BMapLib.RichMarker(htm, point, {"anchor": new BMap.Size(-72, -84), "enableDragging": true});
//                                myRichMarkerObject.disableDragging();
//
//                                //标注点击事件
//                                myRichMarkerObject.addEventListener("onclick", function(e) {
//                                    //var price = getPrice(n.priceMin,n.priceAvg,n.priceMax);
//                                    //var marker = new BMap.Marker(new BMap.Point(n.mapLng,n.mapLat));
//                                    alert(id);
//                                });
//                                myRichMarkerObject.addEventListener("onmouseover", function(e) {
//                                    alert(id);
//                                    $("#m"+id).addClass("hover");
//                                    $("#m"+id).parent("div").css("z-index",99999);
//                                });
//                                myRichMarkerObject.addEventListener("onmouseout", function(e) {
//                                    //document.getElementById("rm3_image").src = "http://1.com/Public/images/icon.png";
//                                    //alert(222);
//                                    $("#m"+id).removeClass("hover");
//                                    $("#m"+id).parent("div").css("z-index",0);
//                                });
//                                map.addOverlay(myRichMarkerObject); // 将标注添加到地图中
//                                 }
//
//                            //标注点击事件
//                            myRichMarkerObject.addEventListener("onclick", function(e) {
//                                //var price = getPrice(n.priceMin,n.priceAvg,n.priceMax);
//                                //var marker = new BMap.Marker(new BMap.Point(n.mapLng,n.mapLat));
//                                alert(id);
//                            });
//                            myRichMarkerObject.addEventListener("onmouseover", function(e) {
//                                alert(id);
//                                $("#m"+id).addClass("hover");
//                                $("#m"+id).parent("div").css("z-index",99999);
//                            });
//                            myRichMarkerObject.addEventListener("onmouseout", function(e) {
//                                //document.getElementById("rm3_image").src = "http://1.com/Public/images/icon.png";
//                                //alert(222);
//                                $("#m"+id).removeClass("hover");
//                                $("#m"+id).parent("div").css("z-index",0);
//                            });
                        } else {
                            alert("ssssssssssssssss");
                            $(".bottom-pull-loading").html("数据测试");
                            setTimeout(function () {
                                $(".bottom-pull-loading").hide();
                            }, 3000);
                        }
                        loading = false;
                    });
                }
            }

            function setIcon(value) {
                return value > 3 ? 2 : 3;
            }


            //富标注函数
            function biaozhu(n) {

                myRichMarker = new BMapLib.RichMarker('<p class="my_marker icon3" id="m' + n.id + '"><span>' + n.buildings_name + '&nbsp;' + n.active_price + '元/㎡</span></div></span></p>', new BMap.Point(n.map_x, n.map_y), {
                    "anchor": new BMap.Size(-12, -38),
                    "enableDragging": false
                });
                //标注点击事件
                myRichMarker.addEventListener("onclick", function (e) {
                    //var price = getPrice(n.priceMin,n.priceAvg,n.priceMax);
                    //var marker = new BMap.Marker(new BMap.Point(n.mapLng,n.mapLat));
                    myInfo(n);
                });
                myRichMarker.addEventListener("onmouseover", function (e) {
                    $("#m" + n.id).addClass("hover");
                    $("#m" + n.id).parent("div").css("z-index", 99999);
                });
                myRichMarker.addEventListener("onmouseout", function (e) {
                    //document.getElementById("rm3_image").src = "http://1.com/Public/images/icon.png";
                    //alert(222);
                    $("#m" + n.id).removeClass("hover");
                    $("#m" + n.id).parent("div").css("z-index", 0);
                });

                map.addOverlay(myRichMarker);

            }

            //弹出信息框
            function myInfo(n) {
                //changeCookie(n);
                var marker = new BMap.Marker(new BMap.Point(n.mapLng, n.mapLat));
                var sContent = '<div class="t_box"><div class="boxt"><h3 class="all366C"> <a target="_blank" href="/buildings/'+n.id+'/460000/'+n.ac_id+'/'+n.buildings_name+'">' + n.buildings_name + '</a></h3>&nbsp;<img src="http://statics.wofangwang.com/images/icon/shou3.gif" width="49" height="19" /></div><div class="boxm"><div class="m1"><div class="txt"><ul><li><em>楼盘类型：</em>' + n.buildings_name + '</li><em>最新特价：</em><li>' + n.active_price + '元/平米</li><li><em>咨询热线：</em><i>' + n.server_phone_num + '</i></li><li><em>楼盘地址：</em> ' + n.address + '</li></ul></div></div></div>';

                //var opt = {
//	 offset:new BMap.Size(-5, -28),
//	};
                var opts = {
                    offset: new BMap.Size(-5, -28)
                }
                var infoWindow = new BMap.InfoWindow(sContent, opts); // 创建信息窗口对象
                map.openInfoWindow(infoWindow, new BMap.Point(n.map_x, n.map_y)); // 打开信息窗口

            }


            var winhetght = $(window).height();
            var winwidth = $(window).width();

            $(".mapp").css("height", winhetght);
            $(".mapp").css("width", winwidth);
        </script>